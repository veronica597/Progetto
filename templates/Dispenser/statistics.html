<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title> Statistics </title>
<meta name ="author" content="Veronica Pecchioli">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous">
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script src="https://code.highcharts.com/highcharts.src.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>

    <style>
        .nav > li > a:focus,
        .nav > li > a:hover
        {
            text-decoration: underline;
            background-color:#bbdefb ;
            text-align: center;
        }

         .table-bordered-costum{
           border-style: solid;
           border-color: white;
       }

        .table > tbody,thead,tr,td,th{
           border-style: inherit;
           border-color: white;
           font-weight: normal;
        }
         .btn-default{
            border-style:dot-dash ;
            border-color: cornflowerblue ;
        }



    </style>

    <script>
        var day ;
        var month ;
        var year ;

        var dayF  ;
        var monthF ;
        var yearF ;


        var requestUrl;



        console.log("tipo year:" +" "+ typeof year);
        console.log("tipo month:" +" "+ typeof month);
        console.log("tipo day:" +" "+ typeof day);

        console.log("tipo yF:" +" "+ typeof yearF);
        console.log("tipo mF:" +" "+ typeof monthF);
        console.log("tipo dF:" +" "+ typeof dayF);


        function pippo(aDiv1,) {
            var e = document.getElementById(aDiv1);

            if (e.style.display == "none") {
                e.style.display = "block"
            }
        }

        function Pippo(aDiv1,aDiv2,aDiv3,aDiv4) {
            var e = document.getElementById(aDiv1);
            var b= document.getElementById(aDiv2);
            var c= document.getElementById(aDiv3);
            var v= document.getElementById(aDiv4);

            b.style.display="inline"; // tengo bloccato menu tendina

            if (v.style.display=="block" ){ // scompare input altro tasto
                v.style.display="none";
            }


            if(c.style.display=="block" ){ // scomare alert
                c.style.display="none";
            }


            if (e.style.display == "none") { //mostro input
                e.style.display = "block"
            }
        }

        // SCRIPT PER I DUE DATETIMEPICKER
        $('#datepickerI'),$('#datepickerF'),$('#datepickerI1').datepicker({
                            weekStart: 1,
                            daysOfWeekHighlighted: "6,0",
                            autoclose: true,
                            todayHighlight: true,
                        });

                        $(function() {
                            $('#datepickerI').datepicker();
                            $('#datepickerF').datepicker();
                            $('#datepickerI1').datepicker();

                            $("#datepickerI1").on("change", function () {
                                day = $(this).datepicker('getDate').getDate();
                                month = $(this).datepicker('getDate').getMonth() + 1;
                                year = $(this).datepicker('getDate').getFullYear();
                                console.log(day);
                                console.log(month);
                                console.log(year);

                                requestUrl = "http://localhost:8000/dispenser/fake/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                    $.get(requestUrl, function (data) {
                                        console.log('DATI RICEVUTI: ' + data);
                                        if (data == 0) {
                                            var l= document.getElementById('mioAlert');
                                            l.style.display='block';
                                        } else {
                                            //window.location.href="http://192.168.1.105:8000/dispenser/dati/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                            window.location.href = "http://localhost:8000/dispenser/dati/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                        }

                                    });

                            });


                            $("#datepickerI").on("change", function () {
                                day = $(this).datepicker('getDate').getDate();
                                month = $(this).datepicker('getDate').getMonth() + 1;
                                year = $(this).datepicker('getDate').getFullYear();
                                console.log(day);
                                console.log(month);
                                console.log(year);

                                $("#datepickerF").removeAttr("disabled"); // riattivo secondo calendario

                                console.log("tipo yeaar" + " " + typeof year);

                                console.log("tipo yearF" + " " + typeof yearF);


                            });


                            //caricamento(); // SE LO METTO QUI MI CARICA INDIPENDENTEMENTE IL GIORNO


                            $("#datepickerF").on("change", function (){

                               // caricamento(); // se lo metto qui il controllo poi mi chiama il giorno selezionato, MA SE IO VOGLIO UN PERIODO?? E CMQ NN VERREBBE NEMMENO IL GIORNO SELEZIONATO PERCHÃ¨ NN CLICCO SU NIENTE
                                dayF = $(this).datepicker('getDate').getDate();
                                monthF = $(this).datepicker('getDate').getMonth() + 1;
                                yearF = $(this).datepicker('getDate').getFullYear();

                                console.log(dayF);
                                console.log(monthF);
                                console.log(yearF);

                                console.log("tipo year2" +" "+ typeof year);
                                console.log("tipo yearF2" +" "+ typeof yearF);
                                caricamento();

                        });


        });

                           function caricamento() {
                                if(year == yearF && month== monthF && day == dayF) {
                                    console.log(" Mostro giorno scelto dal primo cal");
                                   requestUrl = "http://localhost:8000/dispenser/fake/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                    $.get(requestUrl, function (data) {
                                        console.log('DATI RICEVUTI: ' + data);
                                        if (data == 0) {
                                            var l= document.getElementById('mioAlert2');
                                            l.style.display='block';

                                        } else {
                                            //window.location.href="http://192.168.1.105:8000/dispenser/dati/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                            window.location.href = "http://localhost:8000/dispenser/dati/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                        }

                                    });

                                } else{
                                    console.log(" Ho sel anche sul sec calendario. Mostro periodo selezionato! ");
                                    requestUrl = "http://localhost:8000/dispenser/fakeP/?anno=" + year + "&mese=" + month + "&giorno=" + day + "&annoF=" + yearF + "&meseF=" + monthF + "&giornoF=" + dayF + "";
                                    $.get(requestUrl, function (data) {
                                         console.log('DATI RICEVUTI: ' + data);
                                        if (data == 0) {
                                            var l= document.getElementById('mioAlert2');
                                            l.style.display='block';

                                        }else {
                                            window.location.href = "http://localhost:8000/dispenser/statistic/?id=2" + "&anno=" + year + "&mese=" + month + "&giorno=" + day + "&annoF=" + yearF + "&meseF=" + monthF + "&giornoF=" + dayF + "";
                                        }
                                     });


                                }
                            }






    </script>

     <!-- Mi serve per vedere i grafici di ultimo/a mese/settimana  -->

    <script type="text/javascript">


        $(document).ready(function (){
            console.log("pronti alla get");

            // grafico erogazioni automatiche/utente
            var chart = Highcharts.chart('container1', {
                chart: {
                    type: 'column', // column

                },
                title: {
                    text:''
                },

                // sistemare xAxis

                xAxis: {
                    categories: [({{Inizio|safe}} + " to " + {{Fine|safe}})]
                },

                series: [{
                    name: 'Erogazioni automatiche',
                    color: 'green',
                    data: [{{erogA}}],

                }

                    , {
                        name: 'Erogazioni utente',
                        color: 'orange',
                        data: [{{erogU}}],


                    }
                ],


            });


            // grafico erogazioni/no erogazioni

            var chart = Highcharts.chart('container', {
                chart: {
                    type: 'column', // column

                },
                title: {
                    text: ''
                },

                // sistemare xAxis

                xAxis: {
                    categories: [({{Inizio|safe}} + " to " + {{Fine|safe}})]
                },

                series: [{
                    name: 'Erogazioni',
                    color: '#ff00ff',
                    data: [{{erog}}],

                }

                    , {
                        name: 'No erogazioni',
                        color: '#00bfff',
                        data: [{{noErog}}],

                    }
                ],



            }); // chiude il chart





            // grafico erogazioni giorno/notte
            var chart = Highcharts.chart('container2', {  // se metto container -- quando clicco sparisce l'altro grafico e compare quello per cui ho cliccato
                chart: {
                    type: 'column', // column

                },

                title: {
                    text: ''
                },

                // sistemare xAxis

                xAxis: {
                    categories: [({{Inizio|safe}} + " to " + {{Fine|safe}})]
                },

                series: [{
                    name: 'Erogazioni modalitÃ  giorno',
                    color: '#ffd700',
                    data: [{{erogG}}],

                }

                    , {
                        name: 'Erogazioni modalitÃ  notte',
                        color: '#4169e1',
                        data: [{{erogN}}],

                    }
                ],



            }); // chiude il chart

    });


    </script>





</head>



<body style="background-color: #bbdefb">

    <div class="container-fluid">
    <nav class="navbar navbar-light" style="background-color:#eeffff">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainNavBar" style="color: black" >
                <span class="icon-bar" style="background-color:#8aacc8"></span>
                <span class="icon-bar"style="background-color: #8aacc8"></span>
                <span class="icon-bar"style="background-color: #8aacc8"></span>
            </button>
            <a href="#" class="navbar-brand" style="color: black">Food Dispenser</a>
        </div>

        <div class="collapse navbar-collapse" id="mainNavBar" style="text-align: center" >

            <ul class="nav navbar-nav">
                <li ><a href='http://localhost:8000'style="color: black; text-align: center">Home</a></li>
                <li ><a href='#'style="color: black; text-align: center">Last Week</a></li> <!-- E' LA PAGINA CHE VIENE VISUALIZZATA PER DEFAULT DOPO ESSERE STATO REINDIRIZZATO DALLA HOME -->
                <li ><a href='http://localhost:8000/dispenser/statistic/?id=1'style="color: black; text-align: center">Last Month</a></li>
                <li>
                    <nav class="navbar navbar-expand-lg has-megamenu">

                            <div class="menu-wrapper">
                              <ul class="nav navbar-nav">
                                <li class="nav-item dropdown megamenu">
                                  <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-expanded="false" style="color: black" ><span>Choose period to show data</span></a>
                                  <div id="dpm" class="dropdown-menu" >
                                    <div class="row">
                                        <div class="container-fluid"></div>
                                      <div class="col-sm-12">
                                        <div class="link-list-wrapper">
                                          <ul class="link-list">
                                            <li><a class="list-item" href="#"><span><button id="B1" type="button" class="btn btn-default" onclick="Pippo('t1','dpm','mioAlert2','t2')">Day </button></p> </span></a>
                                            </li>
                                              <li><a class="list-item" href="#"><span><button id="B2" type="button" class="btn btn-default" onclick="Pippo('t2','dpm','mioAlert','t1')">Period </button></span></a>
                                              </li>
                                          </ul>
                                        </div>
                                        <div class="col-sm-12">
                                        <div class="link-list-wrapper">
                                          <ul class="link-list">
                                            <li style="display: none" id="t1"><a class="list-item" href="#"><span><p style="color:black">Date:<input data-date-format="dd/mm/yyyy" id="datepickerI1"></p> </span></a>

                                                <div class="row" style="padding: 10px">
                                                    <div class="col-lg-12">
                                                   <div style="display: none" class="alert alert-info" id="mioAlert">No data available!</div>
{#                                                       <script>$('#mioAlert').hide()</script>#}

                                                 </div>
                                                </div>
                                            </li>
                                            <li style="display: none" id="t2"><a class="list-item" href="#"><span><p style="color:black">From:<input data-date-format="dd/mm/yyyy" id="datepickerI"> to: <input data-date-format="dd/mm/yyyy" id="datepickerF" disabled></p></span></a>
                                                <div class="row" style="padding: 10px">
                                                    <div class="col-lg-12">
                                                   <div style="display: none" class="alert alert-info" id="mioAlert2">No data available!</div>
{#                                                       <script>$('#mioAlert2').hide()</script>#}

                                                 </div>
                                                </div>
                                            </li>
                                          </ul>
                                        </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </li>
                              </ul>
                            </div>

                    </nav>
                </li>





                      </ul>
                    </div>


















{#                    <main class="container-fluid">#}
{#                        <div class="row" style="padding: 10px">#}
{#                            <div class="col"><p style="color:black">Date:<input data-date-format="dd/mm/yyyy" id="datepickerI"></p>#}
{#                            </div>#}
{#                        </div>#}
{#                    </main>#}
{#                    <div class="row" style="padding: 10px">#}
{#                    <div class="alert alert-danger" id="mioAlert">No data available!</div>#}
{#                    <script>$('#mioAlert').hide()</script>#}
{#                </div>#}
{#                </li>#}
{#                <li>#}
{#                    <main class="container-fluid">#}
{#                        <div class="row" style="padding: 10px">#}
{#                            <div class="col"><p style="color:black">to:<input data-date-format="dd/mm/yyyy" id="datepickerF" disabled></p> <!-- con disabled Ã¨ spento per default: lo accendo dopo aver selezionato la data nel primo (vedi codice datepickerI sopra) -->#}
{#                            </div>#}
{#                        </div>#}
{#                    </main>#}
{#                </li>#}





    </div>
    </nav>
    </div>








<div class="container-fluid">
<h1 style= "color:cornflowerblue; text-align: center" >Statistics </h1>
</div>


<div class="row">
    <div class="container-fluid">
        <div class="col-sm-4" id="container"></div>
        <div class="col-sm-4" id="container1"></div>
        <div class="col-sm-4" id="container2"></div>
    </div>
</div>

    <div id="d1" class="row" style="display:none; margin-top: 50px;">
        <div class="col-sm-12">
            <table id="oggi" class="table table-hover table-bordered-costum " >
                    <thead>
                    <tr id="prova">
{#                       <th>Id</th>#}
                        <th>Data</th>
                        <th>Erogation</th>
                      <th>UserMode</th>
                        <th>TimeMode</th>
                    </tr>

                    <tbody>
                    {% for riga in righe %}
                        <tr id="old">
{#                           <td id="id">{{riga.id}} </td>#}
                            <td id="date">{{riga.date}} </td>
                            <td id="erogation">{{riga.erogation}} </td>
                          <td id="userMod">{{riga.userMod}} </td>
                            <td id="timeMod">{{riga.timeMod}} </td>
                        </tr>
                    {% endfor %}
                    </tbody>
            </table>
        </div>
    </div>



<div class="text-center">
    <button type= "button" class="btn btn-link" style="color: cornflowerblue" onclick="pippo('d1')">Show the table</button>
</div>



</body>
</html>