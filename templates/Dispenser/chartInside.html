<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> Selected day data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous">
    </script>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script src="https://code.highcharts.com/highcharts.src.js"></script>

    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>

    <style>
        .nav > li > a:focus,
        .nav > li > a:hover
        {
            text-decoration: underline;
            background-color:#bbdefb ;
            text-align: center;
        }

         .table-bordered-costum{
           border-style: solid;
           border-color: white;
       }

        .table > tbody,thead,tr,td,th{
           border-style: inherit;
           border-color: white;
           font-weight: normal;
        }

    </style>

<script>
    function pippo(aDiv1,) {
            var e = document.getElementById(aDiv1);

            if (e.style.display == "none") {
                e.style.display = "block"
            }
        }

        // SCRIPT PER I DUE DATETIMEPICKER
     $('#datepickerI'),$('#datepickerF').datepicker({
                            weekStart: 1,
                            daysOfWeekHighlighted: "6,0",
                            autoclose: true,
                            todayHighlight: true,
                        });

                        $(function() {
                            $('#datepickerI').datepicker();
                            $('#datepickerF').datepicker();


                            $("#datepickerI").on("change",function(){
                                var day = $(this).datepicker('getDate').getDate();
                                var month = $(this).datepicker('getDate').getMonth()+1;
                                var year = $(this).datepicker('getDate').getFullYear();
                                console.log(day);
                                console.log(month);
                                console.log(year);
                                //var requestUrl = "http://192.168.1.105:8000/dispenser/fake/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                var requestUrl = "http://localhost:8000/dispenser/fake/?anno=" + year + "&mese=" + month + "&giorno=" + day + ""; // non funziona boh
                                $.get(requestUrl, function(data) {
                                    console.log('DATI RICEVUTI: ' + data);
                                    if(data == 0){
                                            $('#mioAlert').show()
                                    }

                                    else{
                                         //window.location.href="http://192.168.1.105:8000/dispenser/dati/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                        window.location.href="http://localhost:8000/dispenser/dati/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                    }

                                });

                            });

                            $("#datepickerF").on("change",function(){
                                var day = $(this).datepicker('getDate').getDate();
                                var month = $(this).datepicker('getDate').getMonth()+1;
                                var year = $(this).datepicker('getDate').getFullYear();
                                console.log(day);
                                console.log(month);
                                console.log(year);
                                //var requestUrl = "http://192.168.1.105:8000/dispenser/fake/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                var requestUrl = "http://localhost:8000/dispenser/fake/?anno=" + year + "&mese=" + month + "&giorno=" + day + ""; // non funziona boh
                                $.get(requestUrl, function(data) {
                                    console.log('DATI RICEVUTI: ' + data);
                                    if(data == 0){
                                            $('#mioAlert').show()
                                    }

                                    else{
                                         //window.location.href="http://192.168.1.105:8000/dispenser/dati/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                        window.location.href="http://localhost:8000/dispenser/dati/?anno=" + year + "&mese=" + month + "&giorno=" + day + "";
                                    }

                                });

                            });
                        });


</script>

    <script type="text/javascript">


        $(document).ready(function (){
            console.log("pronti alla get");


            $("#button").click(function(){
                // capire come estrapolo dal click sul calendario l'informazione circa quale giorno ho cliccato

                var amg = {
                    anno: '2019',
                    mese: '10',
                    giorno: '22'
                };

                //var jsonAMG = JSON.stringify(amg);
                var datoStr = "anno=" + amg.anno + "&mese=" + amg.mese + "&giorno=" + amg.giorno + "";

                //console.log(jsonAMG);

                // GRAFICO EROGAZIONI/PASSAGGI

                $.ajax({
                    type: 'GET',
                    //url: "http://192.168.1.105:8000/dispenser/erog/",
                    //url: "http://192.168.6.86:8000/dispenser/erog/",
                    url: "http://localhost:8000/dispenser/erog/",
                    data: datoStr,
                    success: function(data){
                        console.log("dati ricevuti");
                        console.log(data);



                        // grafico
                        var chart = Highcharts.chart('container', {
                            chart: {
                                type: 'column', // column

//                        events: {
//                            load: function () {
//                                var series0 = this.series[0]; // erogazioni automatiche
//                                var series1 = this.series[1]; // erogazioni utente
//                                
//                                var lastId = $('#oggi tr:last').find('#id').html(); 
//                                console.log(lastId); 
//                                var lastDate = $('#oggi tr:last').find('#date').html(); 
//                                console.log(lastDate); 
//                                var lastErog = $('#oggi tr:last').find('#erogation').html(); 
//                                console.log(lastErog); 
//                                var lastUser = $('#oggi tr:last').find('#userMod').html(); 
//                                console.log(lastUser); 
//                                var lastTime = $('#oggi tr:last').find('#timeMod').html(); 
//                                console.log(lastTime); 
//                                
//                                if((typeof lastDate === 'undefined' && typeof lastErog === 'undefined' && typeof lastUser === 'undefined' && typeof lastTime === 'undefined') ||(lastId != data['id'])){
//                                    // se i dati precedenti sono undefined, ovvero non esistono (es: primo dato della giornata)
//                                    // oppure i dati precedenti sono diversi dai dati appena ricevuti
//                                    // allora li renderizzo
//
//                                    console.log("i dati sono undefined o sono diversi a quelli precedenti");
//
//                                    $('#oggi tr:last').after("<tr id='last_insert'>" + "<td id='id'>" + data['id'] + "</td>" + "<td id='date'>" + ' ' + data['date'] + "</td>" +
//                                    "<td id='erogation'>" + data['erogation'] + "</td>" + "<td id='userMod'>" + data['userMod'] + "</td>" +
//                                    "<td id='timeMod'>" + data['timeMod'] + "</td>" + "</tr>"); // riguardare
//                                    
//                                    if(data['erogation'] == 1){
//                                        if(data['userMod'] == true){ // erogazione utente
//                                            series1.addPoint([1], true); 
//                                        }
//                                        else{ // erogazione automatica
//                                            series0.addPoint([0,1], true); 
//                                        }
//                                    }
//                                    
//                                }
//
//                                else{
//                                    console.log("dati già stampati");
//                                }
//                                
//                              
//                                
//                                 POLLING 
//                                
//                                setInterval(function () {  
//                                    console.log("aggiornamento");
//                                     // confronto il contenuto delle variabili "vecchie" con i dati in arrivo e se sono diversi (o undefined) allora li aggiungo 
//                                    
//                                    if((typeof lastDate === 'undefined' && typeof lastErog === 'undefined' && typeof lastUser === 'undefined' && typeof lastTime === 'undefined') ||(lastId != data['id'])){
//                                    // se i dati precedenti sono undefined, ovvero non esistono (es: primo dato della giornata)
//                                    // oppure i dati precedenti sono diversi dai dati appena ricevuti
//                                    // allora li renderizzo
//
//                                    console.log("i dati sono undefined o sono diversi a quelli precedenti");
//
//                                    $('#oggi tr:last').after("<tr id='last_insert'>" + "<td id='id'>" + data['id'] + "</td>" + "<td id='date'>" + ' ' + data['date'] + "</td>" +
//                                    "<td id='erogation'>" + data['erogation'] + "</td>" + "<td id='userMod'>" + data['userMod'] + "</td>" +
//                                    "<td id='timeMod'>" + data['timeMod'] + "</td>" + "</tr>"); // riguardare
//                                    
//                                    if(data['erogation'] == 1){
//                                        if(data['userMod'] == true){ // erogazione utente
//                                            series1.addPoint([0,1], true); 
//                                        }
//                                        else{ // erogazione automatica
//                                            series0.addPoint([0,1], true); 
//                                        }
//                                    }
//                                    
//                                }
//
//                                else{
//                                    console.log("dati già stampati");
//                                }
//        
//                                        
//                                }, 1000);
//                                
//                                
//                                
//                            }
//                        } // chiude events 

                            },
                            title: {
                                text: 'Erogazioni 22 Ottobre 2019'
                            },

                            // sistemare xAxis

                            xAxis: {
                                categories: [data[0]]
                            },

                            series: [{
                                name: 'Erogazioni',
                                color: '#ff00ff',
                                data: [data[1]],

                            }

                                , {
                                    name: 'No erogazioni',
                                    color: '#00bfff',
                                    data: [data[2]],

                                }
                            ],



                        }); // chiude il chart
                    } // chiude success

                }) // chiude ajax



            });
        });


    </script>


{#    <script language="JavaScript" type="text/javascript"> // per tasto che mostra tabella!#}
{##}
{#    function pippo(aDiv1, aDiv2) {#}
{#        var e= document.getElementById(aDiv1);#}
{#        var e2= document.getElementById(aDiv2);#}
{##}
{#        if (e.style.display=="block"){#}
{#            e.style.display="none";#}
{#            e2.style.display="block";#}
{#        }#}
{#    }#}
{#    </script>#}


</head>

<body style="background-color: #bbdefb">

    <div class="container-fluid">
    <nav class="navbar navbar-light" style="background-color:#eeffff">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainNavBar" style="color: black" >
                <span class="icon-bar" style="background-color: #8aacc8"></span>
                <span class="icon-bar" style="background-color: #8aacc8"></span>
                <span class="icon-bar" style="background-color: #8aacc8"></span>
            </button>
            <a href="#" class="navbar-brand" style="color: black">Food Dispenser</a>
        </div>

        <div class="collapse navbar-collapse" id="mainNavBar" style="text-align: center" >

            <ul class="nav navbar-nav">
                <li ><a href='http://localhost:8000'style="color: black; text-align: center">Home</a></li>
                <li ><a href='http://localhost:8000/dispenser/statistic/?id=0'style="color: black; text-align: center">Last Week</a></li> <!-- E' LA PAGINA CHE VIENE VISUALIZZATA PER DEFAULT DOPO ESSERE STATO REINDIRIZZATO DALLA HOME -->
                <li ><a href='http://localhost:8000/dispenser/statistic/?id=1'style="color: black; text-align: center">Last Month</a></li>
                <li>
                    <main class="container-fluid">
                        <div class="row" style="padding: 10px">
                            <div class="col"><p style="color:black">Date:<input data-date-format="dd/mm/yyyy" id="datepickerI"></p>
                            </div>
                        </div>
                    </main>
                    <div class="row" style="padding: 10px">
                    <div class="alert alert-danger" id="mioAlert">No data available!</div>
                    <script>$('#mioAlert').hide()</script>
                </div>
                </li>
                <li>
                    <main class="container-fluid">
                        <div class="row" style="padding: 10px">
                            <div class="col"><p style="color:black">to:<input data-date-format="dd/mm/yyyy" id="datepickerF"></p>
                            </div>
                        </div>
                    </main>
                </li>
            </ul>
        </div>
    </div>
    </nav>
    </div>


<h1 style=" text-align: center; color:cornflowerblue" >Statistics of {{ giorno }}: </h1>


<div class="row">
    <div class="container-fluid">
        <div class="col-sm-4"><div id="container"></div></div>
        <div class="col-sm-4"><div id="container1"></div></div>
        <div class="col-sm-4"><div id="container2"></div></div>
    </div>
</div>

<div id="d1" class="row" style="display:none; margin-top: 50px;">
        <div class="col-sm-12">
            <table id="oggi" class="table table-hover table-bordered-costum " >
                    <thead>
                    <tr id="prova">
{#                       <th>Id</th>#}
                        <th>Data</th>
                        <th>Erogation</th>
                      <th>UserMode</th>
                        <th>TimeMode</th>
                    </tr>

                    <tbody>
                    {% for riga in righe %}
                        <tr id="old">
{#                           <td id="id">{{riga.id}} </td>#}
                            <td id="date">{{riga.date}} </td>
                            <td id="erogation">{{riga.erogation}} </td>
                          <td id="userMod">{{riga.userMod}} </td>
                            <td id="timeMod">{{riga.timeMod}} </td>
                        </tr>
                    {% endfor %}
                    </tbody>
            </table>
        </div>
    </div>



<div class="text-center">
    <button type= "button" class="btn btn-link" style="color: cornflowerblue" onclick="pippo('d1')">Show the table</button>
</div>


<script>

    // grafico erogazioni automatiche/utente
    var chart = Highcharts.chart('container1', {  // se metto container -- quando clicco sparisce l'altro grafico e compare quello per cui ho cliccato
        chart: {
            type: 'column',

        },

        title: {
            text:''
        },

        // sistemare xAxis

        xAxis: {
            categories: [{{Giorno|safe}}]
        },

        series: [{
            name: 'Erogazioni automatiche',
            color: '#ff0000',
            data: [{{erogA}}],

        }

            , {
                name: 'Erogazioni utente',
                color: '#3cb371',
                data: [{{erogU}}],

            }
        ],



    }); // chiude il chart


    // grafico erogazioni/no erogazioni

    var chart = Highcharts.chart('container', {
        chart: {
            type: 'column', // column

        },
        title: {
            text:''
        },

        // sistemare xAxis

        xAxis: {
            categories: [{{Giorno|safe}}]
        },

        series: [{
            name: 'Erogazioni',
            color: '#ff00ff',
            data: [{{erog}}],

        }

            , {
                name: 'No erogazioni',
                color: '#00bfff',
                data: [{{noErog}}],

            }
        ],



    }); // chiude il chart





    // grafico erogazioni giorno/notte
    var chart = Highcharts.chart('container2', {  // se metto container -- quando clicco sparisce l'altro grafico e compare quello per cui ho cliccato
        chart: {
            type: 'column', // column

        },

        title: {
            text:''
        },

        // sistemare xAxis

        xAxis: {
            categories: [{{Giorno|safe}}]
        },

        series: [{
            name: 'Erogazioni modalità giorno',
            color: '#ffd700',
            data: [{{erogG}}],

        }

            , {
                name: 'Erogazioni modalità notte',
                color: '#4169e1',
                data: [{{erogN}}],

            }
        ],



    }); // chiude il chart



</script>



</body>
</html>
