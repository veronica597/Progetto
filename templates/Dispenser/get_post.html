<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Get to the ESP8266</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
                    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous">
    </script>
    <script type="text/javascript" >

        $(document).ready(function (){
            console.log("pronti alla get");

            // Casa Chiara

            var DEVICE_IP = '192.168.1.128'; // indirizzo IP della scheda ESP8266
            var url = "http://192.168.1.105:8000/dispenser/client/";

            // HIGHWAY 4G

            //var DEVICE_IP = '192.168.43.128';
            //var url = "http://192.168.43.37:8000/dispenser/client/";

            // MICC
            //var DEVICE_IP = '192.168.0.134';
            //var url = "http://192.168.0.137:8000/dispenser/client/";

            var data = {
                erogation : 0, // no erogazione
                userMod : 0, // modalita' automatica
            };

            var dataJson = JSON.stringify(data); // converto l'oggetto JS in una stringa JSON

            function success(d){
                $(d).css({border:"3px solid orange"});
            }

            function attivaServo(){
                console.log("click sul bottone 'Ruota il servo'");
                var requestUrl = "http://" + DEVICE_IP + "/servoOpen";
                $.get(requestUrl, function(){
                    alert("sto facendo una get all'ESP8266");
                    var buttonON = $("#on");
                    data.erogation = 1; // erogazione effettuata
                    data.userMod = 1; // modalita' utente
                    dataJson = JSON.stringify(data);
                    $.post(url, dataJson, success(buttonON));
                    $("#stampa").html("Il servo ha ruotato");
                });
            }

            function disattivaServo(){
                console.log("click sul bottone 'Disattiva il servo'");
                var requestUrl = "http://" + DEVICE_IP + "/servoClose";
                $.get(requestUrl, function(){
                    alert("sto facendo la get all'ESP8266");
                    var buttonOFF = $("#off");
                    data.erogation = 0;
                    data.userMod = 0;
                    dataJson = JSON.stringify(data);
                    $.post(url, dataJson, success(buttonOFF));
                    $("#stampa").html("Il servo e' stato disattivato");
                });
            }

            $("#on").click(attivaServo);
            $("#off").click(disattivaServo);

        });


    </script>
    <! --controllare con la cartella static -->

</head>

<body>

    <h1 id="tit"> Let's play with the servo </h1>

    <!-- parte da matchare con arduino -->
    <div id="arduino">

        <button id="on"> Ruota il servo </button> <!--onclick="attivaServo()"-->
        <button id="off"> Disattiva il servo </button> <!--onclick="disattivaServo()" -->

    </div>

    <div id="stampa"></div>

</body>

</html>
